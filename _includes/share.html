<div class="row">
  <div class="small-8 small-offset-2 medium-6 medium-offset-3 columns">
      <div id="errorMessage" class="callout warning hidden" data-closable>
        <span><strong>{{site.data[locale].common.error}}: </strong><span id="errorMessageText"></span></span>
        <button class="close-button" aria-label="Dismiss alert" type="button" data-close>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="successMessage" class="callout success hidden" data-closable>
        <span><strong>{{site.data[locale].common.success}}: </strong><span id="successMessageText"></span></span>
        <button class="close-button" aria-label="Dismiss alert" type="button" data-close>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
  </div>
</div>

<div class="row">
  <div class="small-8 small-offset-2 medium-6 medium-offset-3 columns">
    <h4>{{site.data[locale].share.prompt}}</h4>
    <form id="upload" action="/upload" enctype="multipart/form-data" method="POST">
      <label for="vcaFile" class="button">{{site.data[locale].share.fileBtn}}</label> <span id="selectedFile"></span>
      <input type="file" id="vcaFile" name="vcaFile" class="show-for-sr" accept=".doc,.docx,.pdf" aria-describedby="fileUploadHelpText" required>
      <p class="help-text" id="fileUploadHelpText">{{site.data[locale].share.fileHelp}}</p>
      <label> {{site.data[locale].common.title}}
        <input id="title" type="text" name="title" placeholder="..." required>
      </label>
      <label> {{site.data[locale].common.desc}}
        <textarea id="description" type="text" name="description" placeholder="..." rows= "3" required></textarea>
      </label>
      <label>{{site.data[locale].common.country}}
        <select id="country" name="country" required>
          <option selected disabled hidden style="display: none" value="">{{site.data[locale].share.countryPrompt}}</option>
        </select>
      </label>
      <label>{{site.data[locale].common.year}}
        <select id="year" name="year" required>
          <option selected disabled hidden style="display: none" value="">{{site.data[locale].share.yearPrompt}}</option>
          <option value="2017">2017</option><option value="2016">2016</option><option value="2015">2015</option><option value="2014">2014</option><option value="2013">2013</option><option value="2012">2012</option><option value="2011">2011</option><option value="2010">2010</option><option value="2009">2009</option><option value="2008">2008</option><option value="2007">2007</option><option value="2006">2006</option><option value="2005">2005</option><option value="2004">2004</option><option value="2003">2003</option><option value="2002">2002</option><option value="2001">2001</option><option value="2000">2000</option><option value="1999">1999</option><option value="1998">1998</option><option value="1997">1997</option><option value="1996">1996</option><option value="1995">1995</option><option value="1994">1994</option><option value="1993">1993</option><option value="1992">1992</option><option value="1991">1991</option><option value="1990">1990</option><option value="1989">1989</option><option value="1988">1988</option>
        </select>
      </label>
      <button type="submit" value="submit" class="button primary form-actions__submit">{{site.data[locale].common.submit}}</button>
      <button class="button secondary form-actions__clear">{{site.data[locale].common.clearForm}}</button>
      <i class="fa fa-spinner fa-spin hidden form-actions__spinner" style="font-size:32px; margin-left:12px;" aria-hidden="true"></i>
    </form>
  </div>
</div>

<script>

var locale = "{{locale}}";
window.onload = function() {

  $("#vcaFile").on('change', function() {
    $("#selectedFile").text(this.files[0].name);
  })

  $.get("/api/countries", function(data) {
    for(var i=0, len=data.length; i<len; i++) {
      var country = (data[i][locale] !== null) ? data[i][locale] : data[i]["en"];
      var html = '<option value="' + data[i].code + '">' + country + '</option>';
      $("#country").append(html);
    }
  });

  clearForm = function(){
    $("#upload").find("input").val('');
    $("#description").val('');
    $("#year").val('');
    $("#country").val('');
    $("#selectedFile").empty();
    $(".form-actions__spinner").hide();
    $("form-actions__submit").removeClass("disabled");
    $("html, body").animate({ scrollTop: 0 }, "slow");
  }

  var upload = $("#upload");
  upload.find(".form-actions__clear").click(function(e) {
      e.preventDefault();
      clearForm();
  });
  upload.submit(function() {
    $(this).ajaxSubmit({
      beforeSubmit: function() {
        $(".form-actions__spinner").show();
        $("form-actions__submit").addClass("disabled");
        return true;
      },
      error: function(xhr) {
        $("#errorMessageText").html(xhr.status);
        $("#errorMessage").show();
        clearForm();
      },
      success: function(response) {
        if(response.type === "success"){
          $("#successMessageText").html(response.message);
          $("#successMessage").show();
        } else {
          $("#errorMessageText").html(response.message);
          $("#errorMessage").show();
        }
        clearForm();
      }
    });
    return false;
  });

}

</script>
